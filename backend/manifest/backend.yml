name: GrapeVine
description: A catalog of grape varieties and tasting notes for wine enthusiasts.

entities:
  User:
    authenticable: true
    properties:
      - { name: name, validation: { required: true } }
      - { name: email, type: email, validation: { required: true, unique: true } }
      - { name: role, type: choice, options: { values: [admin, sommelier, enthusiast], default: enthusiast } }
    access_policies:
      - role: admin
        permissions: [create, read, update, delete]
      - role: [sommelier, enthusiast]
        permissions: [read, update]
        condition: "user.id === id"

  GrapeVariety:
    properties:
      - { name: name, validation: { required: true, unique: true } }
      - { name: color, type: choice, options: { values: [Red, White, Ros√©], default: Red }, validation: { required: true } }
      - { name: origin, validation: { required: true } }
      - { name: description, type: text, validation: { required: true } }
      - { name: image, type: image, options: { sizes: { thumbnail: { width: 400, height: 400 } } } }
    hasMany:
      - { name: tastingNotes, entity: TastingNote }
    access_policies:
      - role: admin
        permissions: [create, read, update, delete]
      - role: sommelier
        permissions: [create, read, update]
      - role: enthusiast
        permissions: [read]

  TastingNote:
    properties:
      - { name: rating, type: number, validation: { required: true, min: 1, max: 5 } }
      - { name: notes, type: text, validation: { required: true } }
    belongsTo:
      - { name: author, entity: User }
      - { name: grapeVariety, entity: GrapeVariety }
    access_policies:
      - role: admin
        permissions: [create, read, update, delete]
      - role: [sommelier, enthusiast]
        permissions: [create, read, update, delete]
        condition: "user.id === author.id"